<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PWA Banner - Sempre Vis√≠vel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #8d1d45 0%, #6d1535 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        h2 {
            font-size: 1.8em;
            margin-top: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }
        .step {
            background: rgba(255, 255, 255, 0.15);
            border-left: 4px solid #fff;
            padding: 20px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .step-number {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: white;
            color: #8d1d45;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-right: 12px;
            font-size: 1.1em;
        }
        code {
            background: rgba(0,0,0,0.3);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #ffd700;
        }
        .highlight {
            background: rgba(255, 215, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid rgba(255, 215, 0, 0.5);
            margin: 15px 0;
        }
        .success {
            color: #90EE90;
            font-weight: bold;
        }
        .warning {
            color: #FFD700;
            font-weight: bold;
        }
        ul, ol {
            margin-left: 25px;
            margin-top: 10px;
            line-height: 1.8;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: rgba(255,255,255,0.1);
        }
        th, td {
            text-align: left;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        th {
            background: rgba(255,255,255,0.2);
            font-weight: bold;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: white;
            color: #8d1d45;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin: 10px 5px 10px 0;
            border: none;
            cursor: pointer;
            font-size: 1em;
        }
        .btn:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üîÑ Nova L√≥gica - Banner Sempre Vis√≠vel</h1>
            <p style="font-size: 1.1em; margin-top: 15px; opacity: 0.9;">
                O banner de instala√ß√£o PWA agora aparece <strong>sempre</strong> que o usu√°rio acessar via mobile (exceto se j√° instalado).
            </p>
        </div>

        <div class="card">
            <h2>üìã Mudan√ßas Implementadas</h2>
            
            <div class="highlight">
                <strong>‚ú® ANTES:</strong> Banner aparecia apenas na primeira visita
                <br><br>
                <strong>‚ö° AGORA:</strong> Banner aparece em toda visita mobile
            </div>

            <h3 style="margin-top: 25px; margin-bottom: 15px;">L√≥gica Simplificada:</h3>
            <div class="step">
                <span class="step-number">1</span>
                <strong>√â dispositivo m√≥vel?</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    ‚úì Sim ‚Üí Continua<br>
                    ‚úó N√£o ‚Üí Banner n√£o aparece
                </p>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>App j√° est√° instalado?</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    ‚úì Sim (standalone) ‚Üí Banner n√£o aparece<br>
                    ‚úó N√£o ‚Üí <span class="success">MOSTRA BANNER</span>
                </p>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Usu√°rio clica "Agora n√£o"</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    Banner fecha ‚Üí No pr√≥ximo reload ‚Üí <span class="success">MOSTRA BANNER novamente</span>
                </p>
            </div>
        </div>

        <div class="card">
            <h2>üß™ Teste R√°pido (DevTools)</h2>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>Abrir modo dispositivo</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    Pressione <code>Ctrl+Shift+M</code> no Chrome DevTools<br>
                    Selecione: iPhone, Pixel ou qualquer device < 768px
                </p>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Primeira carga</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    <span class="success">‚úì Banner aparece no bottom</span><br>
                    Anima√ß√£o slide-up, gradiente vinho
                </p>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Fechar banner</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    Clique "Agora n√£o"<br>
                    <span class="success">‚úì Banner fecha com anima√ß√£o</span>
                </p>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Reload (F5)</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    <span class="success">‚úì Banner reaparece automaticamente!</span><br>
                    <span class="warning">‚ö†Ô∏è Este √© o novo comportamento</span>
                </p>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>M√∫ltiplos reloads</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    Pressione F5 v√°rias vezes<br>
                    <span class="success">‚úì Banner aparece em TODOS os reloads</span>
                </p>
            </div>
        </div>

        <div class="card">
            <h2>üìä Compara√ß√£o de Comportamentos</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Cen√°rio</th>
                        <th>Comportamento Antigo</th>
                        <th>Comportamento Novo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Primeira visita mobile</td>
                        <td>‚úì Banner aparece</td>
                        <td><span class="success">‚úì Banner aparece</span></td>
                    </tr>
                    <tr>
                        <td>Segunda visita mobile</td>
                        <td>‚úó Banner n√£o aparece</td>
                        <td><span class="success">‚úì Banner aparece</span></td>
                    </tr>
                    <tr>
                        <td>Ap√≥s fechar banner</td>
                        <td>‚úó Nunca mais aparece</td>
                        <td><span class="success">‚úì Aparece no pr√≥ximo load</span></td>
                    </tr>
                    <tr>
                        <td>Ap√≥s instalar</td>
                        <td>‚úó N√£o aparece (correto)</td>
                        <td><span class="success">‚úó N√£o aparece (correto)</span></td>
                    </tr>
                    <tr>
                        <td>App em standalone</td>
                        <td>‚úó N√£o aparece (correto)</td>
                        <td><span class="success">‚úó N√£o aparece (correto)</span></td>
                    </tr>
                    <tr>
                        <td>Desktop</td>
                        <td>‚úó N√£o aparece (correto)</td>
                        <td><span class="success">‚úó N√£o aparece (correto)</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>üíæ LocalStorage</h2>
            
            <p style="margin-bottom: 15px;">Agora usa apenas 1 flag (antes eram 3):</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Key</th>
                        <th>Uso</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>pwa_installed</code></td>
                        <td>Marca quando app foi instalado</td>
                        <td><span class="success">‚úì Mantida</span></td>
                    </tr>
                    <tr>
                        <td><code>pwa_install_prompt_shown</code></td>
                        <td>Marcava primeira exibi√ß√£o</td>
                        <td><span class="warning">‚úó Removida</span></td>
                    </tr>
                    <tr>
                        <td><code>pwa_install_prompt_dismissed_at</code></td>
                        <td>Timestamp do dismissal</td>
                        <td><span class="warning">‚úó Removida</span></td>
                    </tr>
                </tbody>
            </table>

            <div style="margin-top: 20px;">
                <button class="btn" onclick="checkLocalStorage()">
                    üîç Verificar localStorage
                </button>
                <button class="btn" onclick="clearOldFlags()">
                    üßπ Limpar flags antigas
                </button>
            </div>
            
            <div id="storage-info" style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px; display: none;">
                <pre id="storage-content" style="color: #ffd700; font-size: 0.9em;"></pre>
            </div>
        </div>

        <div class="card">
            <h2>üéØ Casos de Uso</h2>
            
            <h3 style="margin-top: 20px; margin-bottom: 10px;">‚úÖ Quando o banner APARECE:</h3>
            <ul>
                <li>Usu√°rio acessa via Chrome mobile (n√£o instalado)</li>
                <li>Usu√°rio acessa via Safari iOS (n√£o instalado)</li>
                <li>A cada reload/nova visita mobile</li>
                <li>Ap√≥s fechar com "Agora n√£o"</li>
            </ul>

            <h3 style="margin-top: 20px; margin-bottom: 10px;">‚ùå Quando o banner N√ÉO APARECE:</h3>
            <ul>
                <li>Usu√°rio acessa em desktop (largura > 768px)</li>
                <li>App j√° est√° instalado e aberto em standalone</li>
                <li>Flag <code>pwa_installed</code> = true no localStorage</li>
            </ul>
        </div>

        <div class="card">
            <h2>üöÄ Valida√ß√£o em Dispositivo Real</h2>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>Build e serve</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    <code>npm run build && npm run preview</code>
                </p>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Expor via ngrok/tunnel</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    <code>ngrok http 4173</code>
                </p>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Acessar do celular</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    <span class="success">‚úì Banner aparece</span>
                </p>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Fechar banner</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    Toque "Agora n√£o"
                </p>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>Navegar e voltar</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    Saia do app ‚Üí Volte via browser<br>
                    <span class="success">‚úì Banner reaparece!</span>
                </p>
            </div>

            <div class="step">
                <span class="step-number">6</span>
                <strong>Instalar</strong>
                <p style="margin-top: 8px; margin-left: 47px;">
                    Toque "Instalar agora" ‚Üí Instale<br>
                    <span class="success">‚úì Banner para de aparecer</span>
                </p>
            </div>
        </div>

        <div class="card">
            <h2>‚úÖ Checklist de Valida√ß√£o</h2>
            
            <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                <label style="display: block; margin: 10px 0; cursor: pointer;">
                    <input type="checkbox"> Banner aparece em device mode mobile (DevTools)
                </label>
                <label style="display: block; margin: 10px 0; cursor: pointer;">
                    <input type="checkbox"> Banner reaparece ap√≥s reload (F5)
                </label>
                <label style="display: block; margin: 10px 0; cursor: pointer;">
                    <input type="checkbox"> Banner reaparece ap√≥s fechar com "Agora n√£o"
                </label>
                <label style="display: block; margin: 10px 0; cursor: pointer;">
                    <input type="checkbox"> Banner N√ÉO aparece em desktop
                </label>
                <label style="display: block; margin: 10px 0; cursor: pointer;">
                    <input type="checkbox"> Banner N√ÉO aparece ap√≥s instalar
                </label>
                <label style="display: block; margin: 10px 0; cursor: pointer;">
                    <input type="checkbox"> Banner N√ÉO aparece em modo standalone
                </label>
                <label style="display: block; margin: 10px 0; cursor: pointer;">
                    <input type="checkbox"> Android: Prompt nativo funciona
                </label>
                <label style="display: block; margin: 10px 0; cursor: pointer;">
                    <input type="checkbox"> iOS: Modal de instru√ß√µes aparece
                </label>
            </div>
        </div>

        <div class="card">
            <h2>üìö Arquivos Modificados</h2>
            
            <ul style="font-family: 'Courier New', monospace; line-height: 2;">
                <li><span class="success">‚úèÔ∏è</span> src/hooks/usePWAInstall.js</li>
                <li><span class="success">‚úèÔ∏è</span> src/components/PWAInstallBanner.jsx</li>
                <li><span class="success">‚úèÔ∏è</span> src/components/PWADebugPanel.jsx</li>
            </ul>

            <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                <strong>üìñ Documenta√ß√£o completa:</strong><br>
                Consulte <code>PWA_INSTALL_PROMPT.md</code> para detalhes de implementa√ß√£o
            </div>
        </div>
    </div>

    <script>
        function checkLocalStorage() {
            const info = document.getElementById('storage-info');
            const content = document.getElementById('storage-content');
            
            const keys = ['pwa_installed', 'pwa_install_prompt_shown', 'pwa_install_prompt_dismissed_at'];
            let output = 'LocalStorage atual:\n\n';
            
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                output += `${key}: ${value || '(n√£o definido)'}\n`;
            });
            
            content.textContent = output;
            info.style.display = 'block';
        }

        function clearOldFlags() {
            localStorage.removeItem('pwa_install_prompt_shown');
            localStorage.removeItem('pwa_install_prompt_dismissed_at');
            
            alert('‚úÖ Flags antigas removidas!\n\nMantida apenas: pwa_installed');
            checkLocalStorage();
        }
    </script>
</body>
</html>
